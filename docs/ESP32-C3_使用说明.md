# ESP32-C3 电子墨水屏日历使用说明

## 🚀 快速开始

### 1. 开机屏幕测试

ESP32-C3版本在开机时会自动执行屏幕测试：

1. **上电启动** - 连接电源或USB线
2. **屏幕测试** - 自动显示测试内容（约3秒）
3. **测试内容包括**：
   - 标题文字："ESP32-C3 电子墨水屏"
   - 版本信息和引脚配置
   - 黑色和红色文字测试
   - 图形测试（圆形、矩形、边框）
   - 时间戳显示

4. **测试结果**：
   - ✅ 如果屏幕正常显示内容 → 继续执行主程序
   - ❌ 如果屏幕无显示或异常 → 检查接线

### 2. LED状态指示

ESP32-C3使用GPIO12 (D4 LED)进行状态指示：

| LED状态 | 含义 | 说明 |
|---------|------|------|
| 快闪 (每秒2次) | 系统启动中 | 正在连接WiFi |
| 常亮 | WiFi连接成功 | 系统正常运行 |
| 慢闪 (每2秒1次) | WiFi连接失败 | 10秒后进入休眠 |
| 三短闪一长灭 | 配置模式 | 可进行系统配置 |
| 熄灭 | 系统休眠 | 低功耗状态 |

### 3. 按钮操作

ESP32-C3使用GPIO9 (BOOT按键)进行控制：

| 操作 | 功能 | 说明 |
|------|------|------|
| **单击** | 刷新屏幕 | 强制更新日历显示 |
| **双击** | 进入配置 | 启动WiFi配置热点 |
| **长按** | 重置系统 | 清除配置并重启 |

## 🔧 配置说明

### WiFi配置

1. **进入配置模式**：
   - 在LED常亮或慢闪时双击按钮
   - LED变为三短闪一长灭状态

2. **连接配置热点**：
   - 热点名称：`J-Calendar`
   - 默认密码：`password`

3. **配置页面**：
   - 自动弹出配置页面
   - 或手动访问：`http://192.168.4.1`

### 系统配置项

- **WiFi设置**：SSID和密码
- **周首日**：0=周日，1=周一
- **和风天气**：API Key和城市ID
- **倒数日**：名称和日期
- **日期标签**：特殊日期标记

## 🔍 故障排除

### 屏幕问题

**问题**：开机屏幕测试无显示
**解决方案**：
1. 检查电源连接（引脚17-GND，引脚18-3.3V）
2. 检查SPI连接：
   - CLK → 引脚19 (GPIO2)
   - MOSI → 引脚20 (GPIO3)
   - CS → 引脚23 (GPIO7)
3. 检查控制引脚：
   - DC → 引脚22 (GPIO6)
   - RST → 引脚21 (GPIO10)
   - BUSY → 引脚24 (GPIO11)

**问题**：屏幕显示异常或花屏
**解决方案**：
1. 检查屏幕型号是否为GDEY042Z98
2. 尝试降低SPI频率
3. 检查排线连接是否牢固

### WiFi问题

**问题**：WiFi连接失败（LED慢闪）
**解决方案**：
1. 检查WiFi密码是否正确
2. 确认路由器支持2.4GHz频段
3. 检查信号强度是否足够

**问题**：无法进入配置模式
**解决方案**：
1. 确认按钮连接正确（GPIO9）
2. 在LED常亮或慢闪时双击
3. 观察LED是否变为三短闪一长灭

### 系统问题

**问题**：系统无响应
**解决方案**：
1. 检查串口输出（115200波特率）
2. 尝试重新上传固件
3. 检查电源供电是否稳定

**问题**：时间显示错误
**解决方案**：
1. 检查WiFi连接状态
2. 确认时区设置正确
3. 检查NTP服务器连接

## 📋 技术规格

- **开发板**：合宙CORE-ESP32-C3
- **屏幕**：4.2寸三色电子墨水屏 (400x300)
- **通信**：SPI接口
- **电源**：3.3V
- **功耗**：
  - 运行时：约80mA
  - 休眠时：约10μA
- **刷新时间**：约15秒（全屏）

## 🔄 更新固件

### 使用PlatformIO

```bash
# 编译ESP32-C3版本
pio run -e esp32-c3-luatos

# 上传固件
pio run -e esp32-c3-luatos -t upload

# 监控串口
pio device monitor -p COM3 -b 115200
```

### 使用Arduino IDE

1. 选择开发板：ESP32C3 Dev Module
2. 设置参数：
   - Upload Speed: 921600
   - CPU Frequency: 160MHz
   - Flash Mode: DIO
   - Flash Size: 4MB
3. 编译并上传

## 📞 技术支持

如果遇到问题，请提供以下信息：

1. **硬件信息**：
   - 开发板型号
   - 屏幕型号和批次
   - 接线方式

2. **软件信息**：
   - 固件版本
   - 编译环境
   - 串口输出日志

3. **问题描述**：
   - 具体现象
   - 复现步骤
   - LED状态

---

**注意**：ESP32-C3版本专门针对合宙开发板优化，使用了GPIO11解锁功能。如果使用其他ESP32-C3开发板，可能需要调整引脚配置。 